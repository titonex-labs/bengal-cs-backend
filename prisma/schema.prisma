generator client {
    provider = "prisma-client"
    output   = "../generated/prisma"
}

datasource db {
    provider = "postgresql"
}

//* Enum - SeasonStatus
enum SeasonStatus {
    UPCOMING
    ACTIVE
    ENDED
}

//* Enum - BookingStatus
enum BookingStatus {
    PENDING
    CONFIRMED
    STORED
    RELEASED
    COMPLETED
    CANCELED
}

//* Enum - StorageReceiptStatus
enum StorageReceiptStatus {
    RECEIVED
    STORED
    RELEASED
}

//* Enum - LotStatus
enum LotStatus {
    EMPTY
    PARTIAL
    FULL
}

//* Model - Farmer
model Farmer {
    id         String   @id @default(uuid()) @db.Uuid
    agentId    String?  @db.Uuid
    name       String   @db.VarChar(50)
    fatherName String   @db.VarChar(50)
    phone      String   @unique @db.VarChar(15)
    address    String
    createdAt  DateTime @default(now()) @db.Timestamptz
    updatedAt  DateTime @updatedAt @db.Timestamptz

    @@map("farmer")
}

//* Model - Agent
model Agent {
    id        String   @id @default(uuid()) @db.Uuid
    name      String   @db.VarChar(50)
    phone     String   @unique @db.VarChar(15)
    isActive  Boolean  @default(true)
    createdAt DateTime @default(now()) @db.Timestamptz
    updatedAt DateTime @updatedAt @db.Timestamptz

    @@map("agent")
}

//* Model - Season
model Season {
    id        String       @id @default(uuid()) @db.Uuid
    year      String       @unique @db.VarChar(9)
    status    SeasonStatus
    createdAt DateTime     @default(now()) @db.Timestamptz

    @@map("season")
}

//* Model - ChamberLot
model ChamberLot {
    id          String    @id @default(uuid()) @db.Uuid
    floorNo     Int       @db.SmallInt
    chamberNo   Int       @db.SmallInt
    lotNo       Int       @db.SmallInt
    currentLoad Int       @db.SmallInt
    status      LotStatus @default(EMPTY)
    createdAt   DateTime  @default(now()) @db.Timestamptz
    updatedAt   DateTime  @updatedAt @db.Timestamptz

    @@map("chamber_lot")
}

//* Model - Booking
model Booking {
    id            String        @id @default(uuid()) @db.Uuid
    bookingNo     BigInt        @default(autoincrement())
    seasonId      String        @db.Uuid
    agentId       String        @db.Uuid
    farmerId      String        @db.Uuid
    bookedSacks   Int
    advanceAmount Int
    note          String?       @db.VarChar(150)
    status        BookingStatus @default(PENDING)
    bookedAt      DateTime      @default(now()) @db.Timestamptz
    updatedAt     DateTime      @updatedAt @db.Timestamptz

    @@map("booking")
}

//* Model - StorageReceipt
model StorageReceipt {
    id               String               @id @default(uuid()) @db.Uuid
    storageReceiptNo BigInt               @default(autoincrement())
    bookingId        String               @unique @db.Uuid
    chamberNo        Int                  @db.SmallInt
    totalSacks       Int
    totalWeight      Decimal              @db.Decimal(8, 2)
    status           StorageReceiptStatus @default(RECEIVED)

    receivedAt DateTime  @db.Timestamptz
    storedAt   DateTime? @db.Timestamptz
    releasedAt DateTime? @db.Timestamptz
    createdAt  DateTime  @default(now()) @db.Timestamptz
    updatedAt  DateTime  @updatedAt @db.Timestamptz

    @@map("storage_receipt")
}

//* Model - Position
model Position {
    id               String   @id @default(uuid()) @db.Uuid
    bookingId        String   @unique @db.Uuid
    storageReceiptId String   @unique @db.Uuid
    chamberNo        Int      @db.SmallInt
    loadingPosition  String   @db.VarChar(15)
    sacks            Int
    note             String?  @db.VarChar(150)
    createdAt        DateTime @default(now()) @db.Timestamptz

    @@map("position")
}

//* Model - PositionShift
model PositionShift {
    id         String   @id @default(uuid()) @db.Uuid
    positionId String   @db.Uuid
    shiftNo    Int      @db.SmallInt
    note       String?  @db.VarChar(150)
    shiftedAt  DateTime @default(now()) @db.Timestamptz

    @@map("position_shift")
}
